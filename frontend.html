<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fraud Detection Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        @import url('https://rsms.me/inter/inter.css');
        #chat-container::-webkit-scrollbar { width: 6px; }
        #chat-container::-webkit-scrollbar-track { background: #f1f5f9; }
        #chat-container::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 3px;}
        #chat-container::-webkit-scrollbar-thumb:hover { background: #475569; }
    </style>
</head>
<body class="bg-gray-100">
    <div class="flex flex-col h-screen font-sans">
        <header class="bg-white shadow-md p-4 flex items-center shrink-0">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-600 h-8 w-8 mr-3"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
            <h1 class="text-xl font-bold text-gray-800">Fraud Detection Assistant</h1>
        </header>

        <main id="chat-container" class="flex-1 p-4 overflow-y-auto bg-gray-50">
            <div id="message-list" class="space-y-4">
                <!-- Chat messages will be dynamically injected here -->
            </div>
            <div id="messages-end-ref"></div>
        </main>

        <footer class="bg-white border-t p-4 shrink-0">
            <div class="flex items-center bg-gray-100 rounded-xl p-2">
                <input id="user-input" type="text" placeholder="Ask about fraud detection..." class="flex-1 bg-transparent border-none focus:ring-0 text-gray-800 placeholder-gray-500 px-2">
                <button id="send-button" class="bg-blue-600 text-white rounded-lg p-2 hover:bg-blue-700 disabled:bg-blue-300 disabled:cursor-not-allowed transition-colors duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                </button>
            </div>
        </footer>
    </div>

    <script>
        // DOM element references
        const messageList = document.getElementById('message-list');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const messagesEndRef = document.getElementById('messages-end-ref');
        let isLoading = false;

        const scrollToBottom = () => {
            messagesEndRef.scrollIntoView({ behavior: "smooth" });
        };
        
        const setLoadingState = (loading) => {
            isLoading = loading;
            userInput.disabled = loading;
            sendButton.disabled = loading;
        }

        const addMessage = (text, sender) => {
            const existingLoader = document.getElementById('loader');
            if(existingLoader) existingLoader.remove();

            const userIcon = `<div class="bg-gray-300 rounded-full p-2 text-gray-700"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg></div>`;
            const botIcon = `<div class="bg-blue-600 rounded-full p-2 text-white"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg></div>`;
            
            const messageClass = sender === 'user' ? 'bg-blue-500 text-white rounded-br-none' : 'bg-white text-gray-800 rounded-bl-none';
            const justifyClass = sender === 'user' ? 'justify-end' : 'justify-start';
            
            const messageElement = document.createElement('div');
            messageElement.className = `flex items-start gap-3 ${justifyClass}`;
            
            const p = document.createElement('p');
            p.className = 'text-sm';
            p.style.whiteSpace = 'pre-wrap';
            p.appendChild(document.createTextNode(text));

            const messageBubble = document.createElement('div');
            messageBubble.className = `max-w-md p-3 rounded-xl shadow-sm ${messageClass}`;
            messageBubble.appendChild(p);
            
            if (sender === 'bot') {
                messageElement.innerHTML = botIcon;
                messageElement.appendChild(messageBubble);
            } else {
                messageElement.appendChild(messageBubble);
                messageElement.innerHTML += userIcon;
            }

            messageList.appendChild(messageElement);
            scrollToBottom();
        };

        const showLoader = () => {
            const loaderHTML = `<div id="loader" class="flex items-start gap-3 justify-start"><div class="bg-blue-600 rounded-full p-2 text-white"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg></div><div class="bg-white text-gray-800 p-3 rounded-xl rounded-bl-none shadow-sm flex items-center space-x-2"><span class="w-2 h-2 bg-blue-500 rounded-full animate-pulse" style="animation-delay: 0s;"></span><span class="w-2 h-2 bg-blue-500 rounded-full animate-pulse" style="animation-delay: 0.1s;"></span><span class="w-2 h-2 bg-blue-500 rounded-full animate-pulse" style="animation-delay: 0.2s;"></span></div></div>`;
            messageList.insertAdjacentHTML('beforeend', loaderHTML);
            scrollToBottom();
        };

        const handleSend = async () => {
            const text = userInput.value.trim();
            if (text === '' || isLoading) return;

            addMessage(text, 'user');
            userInput.value = '';
            setLoadingState(true);
            showLoader();

            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: text }),
                });
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();
                addMessage(data.reply, 'bot');
            } catch (error) {
                console.error("Error fetching bot response:", error);
                addMessage("Sorry, something went wrong. Please try again.", 'bot');
            } finally {
                setLoadingState(false);
                userInput.focus();
            }
        };

        const fetchWelcomeMessage = async () => {
             setLoadingState(true);
             showLoader();
             try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: "Hello, please provide a welcome message." }),
                });
                 if (!response.ok) throw new Error("Failed to get welcome message");
                 const data = await response.json();
                 addMessage(data.reply, 'bot');
             } catch (error) {
                 console.error("Error fetching welcome message:", error);
                 addMessage("Welcome! How can I help you with credit card fraud detection today?", 'bot');
             } finally {
                 setLoadingState(false);
             }
        };

        sendButton.addEventListener('click', handleSend);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                handleSend();
            }
        });

        document.addEventListener('DOMContentLoaded', fetchWelcomeMessage);
    </script>
</body>
</html>

